<%= javascript_include_tag "rails" %>
  <%= javascript_include_tag :defaults %>
  <%= csrf_meta_tag %>
<table border=1>
  <tr><th>Category</th><th>Tag</th> <th>Content</th> <th>Posted By </th></tr>
  <% @posts.each do |poster| %>
      <tr>
        <td><%= poster.category %></td>
        <td><%= poster.tag %></td>
        <td>
          <%=poster.content %>   <br/>
          <input type=text name="newComment" id="newComment<%=poster.id%>" class="newComment">
          <input type="button" name="<%=poster.id%>" id="commentButton<%=poster.id%>" class="commentButton" value="Comment">
          <ol>
            <% @comments.each do |comment| %>
                <% if comment.post_id==poster.id %>
                    <li><%=comment.content  %> - <%=User.find(comment.user_id).first_name  %></li>
                    <%= button_to "Delete Comment", {:action => :deleteComment,:id => comment} %>
                <% end %>

            <% end %>
            <li id= "yt<%=poster.id%>"></li>

          </ol>


        </td>
        <td><%=poster.user.first_name %> <%=poster.user.last_name %>
          <% if (current_user!=nil &&  (current_user==poster.user || current_user==admin_user || current_user==super_admin_user))%>
              <%= link_to 'Edit', edit_post_path(poster) %>
              <%= button_to 'Delete', poster, method: :delete, :confirm => 'Are you sure?' %>
          <%end%>
          <% if (current_user!=nil &&  (current_user!=poster.user))%>
              <div ><a href="" id="<%= poster.id %>" name="up" class="votes">
                <div class='up'></div> <%= Vote.find_all_by_post_id(poster.id).count %> Votes</a></div></td></tr>
          <%end%>

  <% end %>
</table>

<script>


    $(document).ready(function(){
        $(".votes").one('click',function(){
            var id = $(this).attr("id");
            var name = $(this).attr("name");
            var parent = $(this)
            if (name=='up'){
                $.get('/votedup', {id: id},
                        function(data,status){
                            parent.html(data);
                        });
            }
            $(this).on('click',function(ev){
                ev.preventDefault();
            });

            return false;
        });



    });

    $(document).ready(function(){
        $(".commentButton").on('click',function(){
            var pid = $(this).attr("name");
            var cont = document.getElementById("newComment"+pid).value  ;
            var parent=document.getElementById("yt"+pid)

                $.get('/saveComment', {pid: pid,cont: cont},
                        function(data,status){
                           parent.innerHTML=data
                        });

            $(this).on('click',function(ev){
                ev.preventDefault();
            });


            return false;
        });



    });



</script>